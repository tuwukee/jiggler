#!/usr/bin/env ruby

require 'jiggler'

# require jiggler server classes
require 'jiggler/support/helper'
require 'jiggler/scheduled/enqueuer'
require 'jiggler/scheduled/poller'
require 'jiggler/stats/collection'
require 'jiggler/stats/monitor'
require 'jiggler/errors'
require 'jiggler/retrier'
require 'jiggler/launcher'
require 'jiggler/manager'
require 'jiggler/worker'

require 'jiggler/cli'

begin
  cli = Jiggler::CLI.instance
  cli.parse_and_init
  
  cli.config.logger.info("Jiggler is starting in #{Jiggler.config[:environment].upcase} ✯⸜(*❛‿❛)⸝✯")
  cli.config.logger.info("Jiggler version=#{Jiggler::VERSION} pid=#{Process.pid} concurrency=#{cli.config[:concurrency]} queues=#{cli.config[:queues].join(',')}")

  cli.start
rescue => e
  warn e.message
  warn e.backtrace.join("\n")
  exit 1
end
